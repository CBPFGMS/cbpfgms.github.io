async function c(t,e){try{let r=await fetch(t);if(!r.ok){let o=`HTTP error! status: ${r.status}`;return e.push({errorMessage:o,url:t,date:new Date().toISOString()}),null}return await r.text()}catch(r){throw r instanceof Error?(e.push({errorMessage:r.message,url:t,date:new Date().toISOString()}),new Error(`Error saving CSV file: ${r.message}`)):r}}import{writeFile as g}from"fs/promises";import*as l from"path";function a(t,e,r){try{let o=l.join(t,r);g(o,e,{encoding:"utf-8"}),console.log(`File saved at ${o}`)}catch(o){throw o instanceof Error?new Error(`Error saving CSV file: ${o.message}`):o}}var p=[{url:"https://cbpfapi.unocha.org/vo2/odata/ProjectSummaryV2?",name:"ProjectSummaryV2",type:"yearly"},{url:"https://cbpfapi.unocha.org/vo2/odata/ProjectSummaryAggV2?",name:"ProjectSummaryAggV2",type:"yearly"},{url:"https://cbpfapi.unocha.org/vo2/odata/MstPooledFund?$format=csv",name:"MstPooledFund",type:"complete"},{url:"https://cbpfapi.unocha.org/vo2/odata/MstClusters?$format=csv",name:"MstClusters",type:"complete"},{url:"https://cbpfapi.unocha.org/vo2/odata/MstOrgType?$format=csv",name:"MstOrgType",type:"complete"},{url:"https://cbpfapi.unocha.org/vo2/odata/MstAllocationSource?$format=csv",name:"MstAllocationSource",type:"complete"},{url:"https://cbpfapi.unocha.org/vo2/odata/AllocationTypes?PoolfundCodeAbbrv=&$format=csv",name:"AllocationTypes",type:"complete"}];import*as n from"path";import{fileURLToPath as u}from"url";var y=u(import.meta.url),h=n.dirname(y),i=n.resolve(h,"..","data"),s=[],d=2015,v=2024,m=[],w="&$format=csv",$="AllocationYear=";for(let t=d;t<=v;t++)m.push(t);var S=p.filter(t=>t.type==="yearly"),A=p.filter(t=>t.type==="complete");S.forEach(async t=>{m.forEach(async e=>{let r=`${t.url}${$}${e}${w}`,o=await c(r,s);if(o){let f=`${t.name}_${e}.csv`;await a(i,o,f)}})});A.forEach(async t=>{let e=await c(t.url,s);if(e){let r=`${t.name}.csv`;await a(i,e,r)}});if(s.length>0){let t=JSON.stringify(s,null,2),e=`error_log_${new Date().toISOString().replace(/[:.]/g,"-")}.json`;await a(i,t,e)}await a(i,new Date().toISOString(),"last_updated.txt");console.log("Data fetching and saving completed.");
//# sourceMappingURL=main.js.map
