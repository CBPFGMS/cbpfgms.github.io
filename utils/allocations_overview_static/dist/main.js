async function p(t,r){try{let e=await fetch(t);if(!e.ok){let o=`HTTP error! status: ${e.status}`;return r.push({errorMessage:o,url:t,date:new Date().toISOString()}),null}return await e.text()}catch(e){return e instanceof Error?r.push({errorMessage:e.message,url:t,date:new Date().toISOString()}):r.push({errorMessage:String(e),url:t,date:new Date().toISOString()}),null}}import{writeFile as u}from"fs/promises";import*as l from"path";async function a(t,r,e){try{let o=l.join(t,e);await u(o,r,{encoding:"utf-8"}),console.log(`File saved at ${o}`)}catch(o){console.error(`Error saving file ${e}:`,o)}}var c=[{url:"https://cbpfapi.unocha.org/vo2/odata/ProjectSummaryV2?",name:"ProjectSummaryV2",type:"yearly"},{url:"https://cbpfapi.unocha.org/vo2/odata/ProjectSummaryAggV2?",name:"ProjectSummaryAggV2",type:"yearly"},{url:"https://cbpfapi.unocha.org/vo2/odata/MstPooledFund?$format=csv",name:"MstPooledFund",type:"complete"},{url:"https://cbpfapi.unocha.org/vo2/odata/MstClusters?$format=csv",name:"MstClusters",type:"complete"},{url:"https://cbpfapi.unocha.org/vo2/odata/MstOrgType?$format=csv",name:"MstOrgType",type:"complete"},{url:"https://cbpfapi.unocha.org/vo2/odata/MstAllocationSource?$format=csv",name:"MstAllocationSource",type:"complete"},{url:"https://cbpfapi.unocha.org/vo2/odata/AllocationTypes?PoolfundCodeAbbrv=&$format=csv",name:"AllocationTypes",type:"complete"}];import*as n from"path";import{fileURLToPath as g}from"url";var y=g(import.meta.url),h=n.dirname(y),i=n.resolve(h,"..","data"),s=[],d=2015,v=new Date().getFullYear(),m=[],S="&$format=csv",$="AllocationYear=";for(let t=d;t<=v;t++)m.push(t);var w=c.filter(t=>t.type==="yearly"),P=c.filter(t=>t.type==="complete");for(let t of w)for(let r of m){let e=`${t.url}${$}${r}${S}`,o=await p(e,s);if(o){let f=`${t.name}_${r}.csv`;await a(i,o,f)}}for(let t of P){let r=await p(t.url,s);if(r){let e=`${t.name}.csv`;await a(i,r,e)}}if(s.length>0){let t=JSON.stringify(s,null,2),r=`error_log_${new Date().toISOString().replace(/[:.]/g,"-")}.json`;await a(i,t,r)}await a(i,new Date().toISOString(),"last_updated.txt");
//# sourceMappingURL=main.js.map
