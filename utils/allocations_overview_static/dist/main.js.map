{
  "version": 3,
  "sources": ["../src/fetchdata.ts", "../src/savedata.ts", "../src/apislist.ts", "../src/main.ts"],
  "sourcesContent": ["import { ErrorResponse } from \"./main.ts\";\n\nexport async function fetchData(\n\turl: string,\n\terrorArray: ErrorResponse[]\n): Promise<string | null> {\n\ttry {\n\t\tconst response = await fetch(url);\n\t\tif (!response.ok) {\n\t\t\tconst errorMsg = `HTTP error! status: ${response.status}`;\n\t\t\terrorArray.push({\n\t\t\t\terrorMessage: errorMsg,\n\t\t\t\turl,\n\t\t\t\tdate: new Date().toISOString(),\n\t\t\t});\n\t\t\treturn null;\n\t\t}\n\n\t\treturn await response.text();\n\t} catch (error) {\n\t\tif (error instanceof Error) {\n\t\t\terrorArray.push({\n\t\t\t\terrorMessage: error.message,\n\t\t\t\turl,\n\t\t\t\tdate: new Date().toISOString(),\n\t\t\t});\n\t\t} else {\n\t\t\terrorArray.push({\n\t\t\t\terrorMessage: String(error),\n\t\t\t\turl,\n\t\t\t\tdate: new Date().toISOString(),\n\t\t\t});\n\t\t}\n\t\treturn null;\n\t}\n}\n", "import { writeFile } from \"fs/promises\";\nimport * as path from \"path\";\n\nexport async function saveFile(\n\tdirectoryPath: string,\n\tcontent: string,\n\tfilename: string\n): Promise<void> {\n\ttry {\n\t\tconst filePath = path.join(directoryPath, filename);\n\n\t\tawait writeFile(filePath, content, { encoding: \"utf-8\" });\n\n\t\tconsole.log(`File saved at ${filePath}`);\n\t} catch (error) {\n\t\tconsole.error(`Error saving file ${filename}:`, error);\n\t}\n}\n", "type ApiFile = {\n\turl: string;\n\tname: string;\n\ttype: \"yearly\" | \"complete\";\n};\n\n// url: \"https://cbpfapi.unocha.org/vo3/odata/GlobalGenericDataExtract?SPCode=CBPF_Global_PROJ_SUMMARY_Agg_V3&PoolfundCodeAbbrv=&ShowAllPooledFunds=&AdminLocationLevel=&\",\n\nexport const apiFiles: ApiFile[] = [\n\t{\n\t\turl: \"https://cbpfapi.unocha.org/vo2/odata/ProjectSummaryV2?\",\n\t\tname: \"ProjectSummaryV2\",\n\t\ttype: \"yearly\",\n\t},\n\t{\n\t\turl: \"https://cbpfapi.unocha.org/vo2/odata/ProjectSummaryAggV2?\",\n\t\tname: \"ProjectSummaryAggV2\",\n\t\ttype: \"yearly\",\n\t},\n\t{\n\t\turl: \"https://cbpfapi.unocha.org/vo2/odata/MstPooledFund?$format=csv\",\n\t\tname: \"MstPooledFund\",\n\t\ttype: \"complete\",\n\t},\n\t{\n\t\turl: \"https://cbpfapi.unocha.org/vo2/odata/MstClusters?$format=csv\",\n\t\tname: \"MstClusters\",\n\t\ttype: \"complete\",\n\t},\n\t{\n\t\turl: \"https://cbpfapi.unocha.org/vo2/odata/MstOrgType?$format=csv\",\n\t\tname: \"MstOrgType\",\n\t\ttype: \"complete\",\n\t},\n\t{\n\t\turl: \"https://cbpfapi.unocha.org/vo2/odata/MstAllocationSource?$format=csv\",\n\t\tname: \"MstAllocationSource\",\n\t\ttype: \"complete\",\n\t},\n\t{\n\t\turl: \"https://cbpfapi.unocha.org/vo2/odata/AllocationTypes?PoolfundCodeAbbrv=&$format=csv\",\n\t\tname: \"AllocationTypes\",\n\t\ttype: \"complete\",\n\t},\n];\n", "import { fetchData } from \"./fetchdata.js\";\nimport { saveFile } from \"./savedata.js\";\nimport { apiFiles } from \"./apislist.js\";\nimport * as path from \"path\";\nimport { fileURLToPath } from \"url\";\n\nexport type ErrorResponse = {\n\terrorMessage: string;\n\turl: string;\n\tdate: string;\n};\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\nconst DIRECTORY_PATH = path.resolve(__dirname, \"..\", \"data\");\n\nconst errorArray: ErrorResponse[] = [];\n\nconst firstYear = 2015,\n\tlastYear = new Date().getFullYear(),\n\tyearsArray: number[] = [];\n\nconst csvFormatParameter = \"&$format=csv\",\n\tyearParameter = \"AllocationYear=\";\n\nfor (let year = firstYear; year <= lastYear; year++) {\n\tyearsArray.push(year);\n}\n\nconst yearlyApis = apiFiles.filter(api => api.type === \"yearly\");\nconst completeApis = apiFiles.filter(api => api.type === \"complete\");\n\nfor (const api of yearlyApis) {\n\tfor (const year of yearsArray) {\n\t\tconst url = `${api.url}${yearParameter}${year}${csvFormatParameter}`;\n\t\tconst data = await fetchData(url, errorArray);\n\t\tif (data) {\n\t\t\tconst fileName = `${api.name}_${year}.csv`;\n\t\t\tawait saveFile(DIRECTORY_PATH, data, fileName);\n\t\t}\n\t}\n}\n\nfor (const api of completeApis) {\n\tconst data = await fetchData(api.url, errorArray);\n\tif (data) {\n\t\tconst fileName = `${api.name}.csv`;\n\t\tawait saveFile(DIRECTORY_PATH, data, fileName);\n\t}\n}\n\nif (errorArray.length > 0) {\n\tconst errorLogContent = JSON.stringify(errorArray, null, 2);\n\tconst errorLogFileName = `error_log_${new Date()\n\t\t.toISOString()\n\t\t.replace(/[:.]/g, \"-\")}.json`;\n\tawait saveFile(DIRECTORY_PATH, errorLogContent, errorLogFileName);\n}\n\nawait saveFile(DIRECTORY_PATH, new Date().toISOString(), \"last_updated.txt\");"],
  "mappings": "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",
  "names": ["fetchData", "url", "errorArray", "response", "errorMsg", "error", "writeFile", "path", "saveFile", "directoryPath", "content", "filename", "filePath", "error", "apiFiles", "path", "fileURLToPath", "__filename", "__dirname", "DIRECTORY_PATH", "errorArray", "firstYear", "lastYear", "yearsArray", "csvFormatParameter", "yearParameter", "year", "yearlyApis", "apiFiles", "api", "completeApis", "url", "data", "fetchData", "fileName", "saveFile", "errorLogContent", "errorLogFileName"]
}
